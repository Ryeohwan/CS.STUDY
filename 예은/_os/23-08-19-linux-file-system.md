### What is File and File System

파일은 컴퓨터에서 의미가 있는 정보를 담은 논리적 단위이다. 컴퓨터는 0과 1로 된 정보가 저장되어있고 그 0과 1이 모여 하나의 음악정보를 담고 있는 것이다. 파일은 크게 실행 파일(.exe)과 데이터 파일이 존재하고 이런 파일들을 잘 관리하기 위해서 파일 시스템이 필요하다.

-   파일을 새로 생성하고 싶은데 하드 디스크 몇번째 주소가 비어있지?
-   파일을 실행하고 싶은데 하드 디스크 몇번째 주소에 있지?
-   누가 내 파일을 삭제했지..?

파일 시스템은 이처럼 파일을 효율적으로 관리하고 쉽게 사용할 수 있도록 하는 시스템이다.

파일 시스템은 어떤 효율성을 극대화 하고자 하는 지에 따라 조금씩 다르게 설계되었다.

-   Windows → NTFS
-   Mac → APFS
-   Linux → EXT ( extended file system )
-   CentOS → xfs

### Linux File System : ext2 → ext3 → ext4

누가? 1991 년 21 살 리누스 토발즈가 그당시 교육용이였던 Minix를 확장한 파일 시스템을 만들었고 Minix와 호환이 가능한 파일 시스템을 개발했다. 그래서 이름이 extended file system 이다. 주요기능으로 다음과 같이 4가지가 있다.

-   파일의 할당 : 새로 생성할 파일을 디스크에 할당하는 방법
-   파일의 접근 : 사용자가 원하는 파일을 디스크에서 접근하는 방법
-   파일의 보호 : 파일의 접근 권한을 관리하는 방법
-   파일의 일관성 : 파일의 내용이 손상되지 않도록 해주는 방

### 파일의 할당

-   블록 : 하드 디스크와 데이터를 주고 받을 때 사용되는 논리적 단위 ( 일반적으로는 4KB )

파일이 새로 만들어질때 디스크에는 어떤 정보가 저장되어야할까? 디스크에는 파일에 대한 두 가지 정보가 저장된다.

-   data: 실제로 가지고 있는 내용 → datablock에 저장
-   matadata: 파일의 길이, 접근권한, 수정시간등 파일에 대한 데이터 → inode 자료구조로 inodeblock에 저장된다
    **inode 자료구조를 사용하는 이유?** 크기가 큰 파일도 효율적으로 저장하기 위해서 inode는 다이렉트로 data블럭을 가리킬수도 있고 몇번의 참조로 data 블럭을 가리킬 수 도 있다.
    ext는 디스크를 크기가 같은 여러개의 **블록 그룹**으로 나누고 한개의 블록 그룹은 다음과 같이 구성되어있다.
    ![Image](https://user-images.githubusercontent.com/103018534/261776005-7cce0096-66b8-4746-b774-b16bd50acdca.png)
    각각의 Bitmap을 통해 어디 블럭이 비어있는지 알수 있다 ( 1: 사용중, 0: 사용안함)

### 파일의 접근

사용자는 해당 파일에 접근하기 위해 디렉터리 경로/ + 파일이름을 사용해 파일에 접근할 수 있다. 파일 시스템은 디렉터리도 파일로 다루기 때문에 디렉터리도 inode를 가진다. 특정 경로가 자주 참조된다면 캐싱을 통해 디스크에 잦은 접근을 줄일 수 있다.

리눅스는 파일과 디렉터리를 연결할 수 있는 또 다른 방법으로 링크(Link)를 제공한다. 링크는 서로 다른 디렉터리에서 같은 파일을 접근하는 방법으로 링크의 종류에는 다음과 같이 두가지가 있다.

-   Hard link → 깊은 복사처럼 원본파일 데이터를 data 블록에 저장하다
-   Symbolic link →원본파일의 경로를 data 블록에 저장한다 ex) 윈도우의 바로가기

( 마치 깊은 복사, 얕은 복사 같은 개념인 것 같다 )

### 파일의 보호

파일을 보호하기 위해 리눅스는 파일의 접근을 제한한다.

-   Acess Control List ( ACL) : 누가 어떤 연산을 할수 있는지 리스트 형식으로 관리
-   접근 권한 비트: 파일의 소유자, 공유하는 그룹, 기타 사용자들의 접근 권한을 고정적인 9개의 비트로 나타낸다. → 개발하면서 많이 봤던 형태이다.
    리눅스는 사용자를 3가지로 분류한다
    -   user : 소유자
    -   group : 소유자가 속한 그룹
    -   others: 소유자가 속한 그룹에 속하지 않은 사용자
    ```bash
    touch temp
    # user:011 group:111 others:110
    chmod 675 temp
    # user에게 실행 권한 추가, group 에게 읽기쓰기권한 할당, others에게 실행권한 빼
    chmod u+x,g=rw,o-x temp
    ```

### 파일의 일관성

파일을 생성하다가 디스크가 꺼질때 파일의 일관성을 유지하기 위해 나온 기능에는 fsck(File System Checker)와 저글링(Journaling)이 있다

-   저글링은 inode나 비트맵이 수정 될때 그 기록을 파일 시스템 내에 별도의 영역에 저장한다. ( 하나의 파일 연산에 기록되는 로그의 집합을 트랜잭션이라고 한다, 하나의 트랜잭션이 모두 기록되면 commit 되었다고 부르 실제 inode와 비트맵에 이를 반영한)

### 추가 : Mount

하드디스크, USB 등의 2차 저장장치가 있을 때 각각 독립적인 root가 있는 파일 시스템이다. 예를 들어 windows에서 ssd를 연결하면 새로운 E 드라이브가 자동으로 생긴긴다. 하지만 리눅스는 이를 자동으로 하지 않고 특정 디렉터리 아래로 지정 할 수 있어서 하나의 파일 시스템으로 관리할 수 있도록 해준다.

### 추가 : File Allocation

indexed allocation…

### Linux Directory and Inode

![Image](https://user-images.githubusercontent.com/103018534/261776006-061095f5-797f-4adc-806b-80e37c7d9317.png)

| 디렉토리 명 | 설명                                                                               |
| ----------- | ---------------------------------------------------------------------------------- |
| home        | 사용자 홈 디렉토리가 생성되는 곳입니다.                                            |
| media       | CD_ROM이나 USB같은 외부 장치를 연결하는 디렉토리입니다.                            |
| opt         | 추가 패키지가 설치되는 디렉토리입니다.                                             |
| dev         | 장치파일들이 저장되어 있는 디렉토리입니다.                                         |
| root        | root계정의 홈 디렉토리입니다. (/ 디렉토리와는 다릅니다.)                           |
| sys         | 리눅스 커널관련 정보가 있는 디렉토리입니다.                                        |
| usr         | 기본 실행파일과 라이브러리 파일, 헤더 파일등의 파일이 저장되어있는 디렉토리입니다. |
| boot        | 부팅에 필요한 정보를 가진 파일들이 있는 디렉토리입니다.                            |
| var         | 시스템 운영중에 발생한 데이터와 로그가 저장되는 디렉토리입니다.                    |
| tmp         | 시스템 사용중에 발생한 임시데이터가 저장됩니다. (부팅 시 초기화)                   |
| srv         | FTP나 Web등 시스템에서 제공하는 서비스의 데이터가 저장되는 디릭토리입니다.         |
| run         | 실행중인 서비스와 관련된 파일이 저장되는 디렉토리입니다.                           |
| proc        | 프로세스 정보 등 커널 관련 정보가 저장되는 디렉토리입니다.                         |
| mnt         | 파일 시스템을 임시로 연결하는 디렉토리입니다.                                      |
| etc         | 리눅스 설정을 위한 각종 파일들을 가지고 있는 디렉토리입니다.                       |
