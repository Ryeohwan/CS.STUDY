# 개념

    Nginx는 웹 서버이다.

클라이언트로부터 요청을 받았을 때 요청에 맞는 정적 파일을 응답해주는 HTTP Web Server로 활용되기도 하고,
Reverse Proxy Server로 활용하여 WAS 서버의 부하를 줄일 수 있는 로드 밸런서로 활용되기도 한다.

# 웹 서비스의 구조
- 클라이언트 -> 웹 서버 -> WAS -> DB 순으로 요청이 되고
- DB -> 웹 서버 -> 클라이언트 순으로 응답이 된다.

<img width="812" alt="image" src="https://github.com/Ryeohwan/TRL/assets/73810834/257cdfad-b3f4-4421-a10b-738b2c1e94d2">

- 웹 서버를 이용하는 이유는 무엇일까

1. WAS 의 부담을 덜어주기 위해서 사용된다. WAS 는 로그인, 회원가입, 개인정보 수정 등 동적 작업을 처리하는 것만으로 작업량이 많다. HTML, CSS, JS, 이미지 등의 정적인 파일을 클라이언트에게 전달하는 역할을 웹 서버에게 위임함으로써 WAS 작업의 부하를 줄인다.
2. 보안 기능을 제공한다. 웹 서버는 보안 기능을 제공하여 웹 페이지에 대한 접근을 제한할 수 있다. 웹 서버는 SSL/TLS 프로토콜을 사용하여 데이터를 암호화하고 엑세스 제어, 웹 방화벽 등의 보안 기능을 제공하여 웹 사이트를 보호할 수 있다.
3. 높은 성능을 제공한다. 웹 서버는 대부분 비동기 처리 방식을 사용하여 높은 성능을 제공한다. 예를 들어서 Nginx, Apache 등의 웹 서버는 이벤트 기반, 멀티 프로세싱, 스레드 풀 등의 기술을 사용하여 수천 대의 클라이언트 요청을 동시에 처리할 수 있다.


# 흐름
![image](https://github.com/Ryeohwan/TRL/assets/73810834/8cdce7a5-6cb8-40ca-9246-c49e7c0d4077)

- Nginx는 Event-Driven 구조로 동작하기 때문에 한 개 또는 고정된 프로세스만 생성하여 사용하고,
비동기 방식으로 요청들을 Concurrency 하게 처리할 수 있다.
- 위의 그림에서 보이듯이 Nginx는 새로운 요청이 들어오더라도 새로운 프로세스와 쓰레드를 생성하지 않기 때문에 프로세스와 쓰레드 생성 비용이 존재하지 않고,
적은 자원으로도 효율적인 운용이 가능하다.
- 이러한 Nginx의 장점 덕분에 단일 서버에서도 동시에 많은 연결을 처리할 수 있습니다.

## Event-Driven
- apache 의 C10K 문제점 해결(한 시스템에 동시 접속자수가 1만명이 넘어갈 때 효율적방안)을 위해 만들어진 Event-Driven 구조의 웹서버SW 라고 한다.
- OSI7 Layer 중 application Level 아래의 Level 에서 Nginx 같은 웹서버가 HTTP 통신을 담당한다.


# Nginx의 구조
- Nginx는 하나의 Master Process와 다수의 Worker Process로 구성되어 실행된다. Master Process는 설정 파일을 읽고,
유효성을 검사 및 Worker Process를 관리한다.
- 모든 요청은 Worker Process에서 처리한다. Nginx는 이벤트 기반 모델을 사용하고, Worker Process 사이에 요청을 효율적으로 분배하기 위해 OS에 의존적인 메커니즘을 사용한다.
- Worker Process의 개수는 설정 파일에서 정의되며, 정의된 프로세스 개수와 사용 가능한 CPU 코어 숫자에 맞게 자동으로 조정된다.

![image](https://github.com/Ryeohwan/TRL/assets/73810834/dea5ee0d-a42b-46ff-a64c-bcb190c77b79)

# 그럼 Nginx를 사용하는 이유가 무엇일까

1. 높은 성능과 적은 메모리 사용

Nginx는 비동기 I/O 처리 방식을 사용하여 높은 성능을 제공한다. 
이를 통해 대규모 웹 사이트에서도 빠른 응답 시간을 보장할 수 있다.
또한 Nginx는 적은 메모리 사용량으로도 높은 성능을 제공한다. 이를 통해 서버 운용 비용을 절감할 수 있다.

2. 리버스 프록시 사용이 가능

프록시의 사전적 정의는 대리이다. 인터넷 접속을 할 때 보안상의 문제로 직접 통신을 주고받을 수 없을 때 그 사이의 중계기로서 대리로 통신을 수행하는 기능을 프록시고 한다. 이렇게 중계를 기능하는 것을 우리는 프록시 서버라고 한다. 프록시는 크게 포워드 프록시, 리버스 프록시로 구분된다.

- 포워드 프록시는 클라이언트와 인터넷 그 사이에 있는 영역을 말한다.

<img width="617" alt="image" src="https://github.com/Ryeohwan/TRL/assets/73810834/48575c9d-41fa-444a-9c95-7341b9e61606">

클라이언트가 어떠한 정보를 요청하면 프워드 프록시가 이를 대신 받아서 서버에게 전달한다. 이후 서버의 응답 또한 포워드 프록시가 대신 받아 클라이언트에게 전달한다. 
포워드 프록시를 사용하면 클라이언트의 IP주소가 웹 서버에 노출되지 않는다. 따라서 클라이언트의 위치나 신원을 식별하는 것이 어려워져 보안이 강화된다.
또한 접근 제어를 수행할 수 있다. 포워드 프록시를 사용하여 특정 IP주소, 도메인 또는 URL에 대한 접근을 제한할 수 있다. 
마지막으로 미디어 스트리밍을 사용할 수 있다. 미디어 파일은 일반적으로 큰 용량을 가지고 있기 때문에, 웹 서버에서 직접 전송하는 것은 효율적이지 않다. 포워드 프록시를 사용하여 미디어 파일을 캐시하고, 클라이언트에게 빠르게 제공할 수 있다.

- 리버스 프록시는 인터넷과 백엔드 그 사이에 있는 서버 영역을 말한다.

<img width="617" alt="image" src="https://github.com/Ryeohwan/TRL/assets/73810834/457a92f7-5ba0-4f19-8a4c-4365f5bf5313">

예를 들어 WAS로 사용되고 있는 서버가 여러 대 있다고 가정한다면 클라이언트가 https://example/blog1, https://example/blog2 로 접근을 했다면 blog1은 A서버로 전달, blog2는 B서버로 전달하여 요청에 해당하는 웹 서버로 길을 분배할 수 있다. 이것을 로드 밸런싱이라고 한다.

- 그리고 캐싱 서버로 이용할 수 있다. 예를 들어 클라이언트가 이미지를 요청했을 때 처음에는 서버에서 가져오지만 이후에 동일한 요청이 있을 경우에는 캐시 서버에서 가져와 클라이언트에게 전달해 준다. 이것으로 사이트의 접속 속도를 빠르게 할 수 있다. 

3. 데이터 압축
클라이언트가 보내는 요청이 Text일 경우에는 gzip을 사용하여 해당 데이터를 압축시킬 수 있다.

4. 비동기 처리
Nginx는 이벤트루프 방식을 사용하여 높은 성능을 제공한다. 이를 통해 동시에 여러 요청이 들어왔을 떄도 많은 트래픽을 동시에 처리할 수 있어 빠른 응답 시간을 보장한다.

# 추가적으로 생각해볼 것
- 엄청난 요청으로 Nginx가 만약 터지게 된다면 어떻게 해야할까